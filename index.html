<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Featuring ì¸í„°ë·° ì¼ì • ì„ íƒ</title>
  <style>
    /* ê¸°ì¡´ CSS ê·¸ëŒ€ë¡œ ìœ ì§€ */
    :root { --accent: #5E51FF; --line: #5E51FF; --ink: #111; --muted: #6b7280; } 
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f3f4f6; margin: 0; padding: 20px; box-sizing: border-box; } 
    .card { background: white; padding: 32px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.07); width: 100%; max-width: 600px; } 
    h1 { margin: 0 0 8px; font-size: 24px; color: var(--ink); } 
    .subtitle { margin: 0 0 24px; font-size: 16px; color: var(--muted); } 
    .form-group { margin-bottom: 20px; } 
    label { font-weight: 600; display: block; margin-bottom: 8px; } 
    .checkbox-group label { display: flex; align-items: center; padding: 12px; border: 1px solid var(--line); border-radius: 8px; cursor: pointer; margin-bottom: 10px; transition: all .15s ease; } 
    .checkbox-group label:hover { background: #f9fafb; border-color: var(--accent); } 
    .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; margin-right: 12px; } 
    input[type="email"] { width: 100%; padding: 12px; border: 1px solid var(--line); border-radius: 8px; font-size: 15px; box-sizing: border-box; } 
    button { width: 100%; padding: 14px; background: var(--accent); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background .2s ease; } 
    button:disabled { background: #d1d5db; cursor: not-allowed; } 
    .message { text-align: center; padding: 20px; font-size: 18px; }
  </style>
</head>
<body>

  <div class="card" id="form-container">
    <h1>ğŸ—“ï¸ Featuring ì¼ì • ì„ íƒ</h1>
    <p class="subtitle">
      <strong id="disp-name">ì§€ì›ì</strong> / <span id="disp-position">í¬ì§€ì…˜</span>
    </p>

    <div class="form-group">
      <label for="email">ì•ˆë‚´ ë©”ì¼ì„ ìˆ˜ì‹ í•œ ì´ë©”ì¼ ì£¼ì†Œ</label>
      <input type="email" id="email" placeholder="ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ìˆ˜ì‹ í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
    </div>

    <div class="form-group">
      <label>ê°€ëŠ¥í•œ ì¼ì •ì„ ìµœëŒ€ 3ê°œ ì„ íƒí•´ì£¼ì„¸ìš” (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
      <div id="date-options" class="checkbox-group">
        </div>
      
      <div class="checkbox-group">
        <label for="other">
          <input type="checkbox" id="other" name="schedule" value="ê¸°íƒ€(ë³„ë„ ë¬¸ì˜)">
          <span>ê¸°íƒ€ (ì œì•ˆëœ ì¼ì •ì´ ë¶ˆê°€í•œ ê²½ìš°, í•´ë‹¹ ë²„íŠ¼ì„ ì œì¶œí•˜ê³  ê°€ëŠ¥í•œ ì¼ì • 2~3ê°œ recruit@featuring.in ìœ¼ë¡œ íšŒì‹  ë¶€íƒ ë“œë¦½ë‹ˆë‹¤.)</span>
        </label>
      </div>
    </div>
    
    <button id="submit-btn" onclick="submitDates()">ì œì¶œí•˜ê¸°</button>
  </div>

  <div class="card" id="success-message" style="display:none;">
    <p class="message">âœ…<br><br>ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ê²€í†  í›„ ë¹ ë¥´ê²Œ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
  </div>

<script>
  // âš ï¸ ì¤‘ìš”: ë°°í¬í•œ êµ¬ê¸€ ì›¹ì•± URLì„ ì—¬ê¸°ì— ë„£ì–´ì•¼ í•©ë‹ˆë‹¤.
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/ì•„ì´ë””_ì…ë ¥_í•„ìˆ˜/exec";

  // URL íŒŒë¼ë¯¸í„° ì½ê¸° (ì˜ˆ: github.io/...?name=í™ê¸¸ë™&dates=ë‚ ì§œ1,ë‚ ì§œ2)
  const urlParams = new URLSearchParams(window.location.search);
  const pName = urlParams.get('name') || 'ì§€ì›ì';
  const pPosition = urlParams.get('position') || 'í¬ì§€ì…˜';
  const pEmail = urlParams.get('email') || '';
  const pStage = urlParams.get('stage') || 'ì¸í„°ë·°';
  const pDates = urlParams.get('dates') ? urlParams.get('dates').split(',') : [];
  const pRequestId = urlParams.get('rid') || '';

  // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì„¸íŒ…
  window.onload = function() {
    document.getElementById('disp-name').textContent = pName;
    document.getElementById('disp-position').textContent = pPosition;
    if(pEmail) document.getElementById('email').value = pEmail;

    const dateContainer = document.getElementById('date-options');
    
    // ë‚ ì§œ ì˜µì…˜ ë™ì  ìƒì„±
    pDates.forEach((date, index) => {
      const label = document.createElement('label');
      label.innerHTML = `
        <input type="checkbox" id="date${index}" name="schedule" value="${date}">
        <span>${date}</span>
      `;
      dateContainer.appendChild(label);
    });

    setupCheckboxListeners();
  };

  // ì²´í¬ë°•ìŠ¤ ë¡œì§ (ê¸°íƒ€ ì„ íƒ ì‹œ í•´ì œ ë“±)
  function setupCheckboxListeners() {
    const otherCb = document.getElementById('other');
    const allCbs = document.querySelectorAll('input[name="schedule"]');
    
    otherCb.addEventListener('change', () => {
      if (otherCb.checked) {
        allCbs.forEach(cb => { if(cb !== otherCb) cb.checked = false; });
      }
    });

    allCbs.forEach(cb => {
      if(cb !== otherCb) {
        cb.addEventListener('change', () => {
          if(cb.checked) otherCb.checked = false;
        });
      }
    });
  }

  // 2. ì œì¶œí•˜ê¸°
  function submitDates() {
    const emailEl = document.getElementById('email');
    if (!emailEl.value || !emailEl.value.includes('@')) {
      alert('ì •í™•í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const selectedCheckboxes = document.querySelectorAll('input[name="schedule"]:checked');
    if (selectedCheckboxes.length === 0) {
      alert('í•˜ë‚˜ ì´ìƒì˜ ì¼ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }

    const selectedDates = Array.from(selectedCheckboxes).map(cb => cb.value);
    const OTHER_VALUE = "ê¸°íƒ€(ë³„ë„ ë¬¸ì˜)";
    const hasOther = selectedDates.includes(OTHER_VALUE);

    if (!hasOther && selectedDates.length > 3) {
      alert('ê°€ëŠ¥ ì¼ì •ì€ ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      return;
    }

    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'ì œì¶œ ì¤‘...';

    // ì „ì†¡í•  ë°ì´í„°
    const payload = {
      applicantName: pName,
      positionName: pPosition,
      interviewStage: pStage,
      email: emailEl.value,
      selectedDates: selectedDates,
      requestId: pRequestId
    };

    // fetch APIë¡œ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ì— POST ìš”ì²­
    // mode: 'no-cors'ë¥¼ ì“°ë©´ ì‘ë‹µ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ì—†ì§€ë§Œ, CORS ì—ëŸ¬ë¥¼ ìš°íšŒí•˜ì—¬ ì „ì†¡ì€ ë©ë‹ˆë‹¤.
    // í•˜ì§€ë§Œ ì‘ë‹µ(ì„±ê³µ/ì¤‘ë³µ ë“±)ì„ í™•ì¸í•˜ë ¤ë©´ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ê°€ JSONPë‚˜ ì˜¬ë°”ë¥¸ CORS í—¤ë”ë¥¼ ì¤˜ì•¼ í•©ë‹ˆë‹¤.
    // ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•: text/plainìœ¼ë¡œ ë³´ë‚´ê³  ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ë”°ë¥´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
    
    fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
      if (data.result === 'success') {
        document.getElementById('form-container').style.display = 'none';
        document.getElementById('success-message').style.display = 'block';
      } else if (data.result === 'already_submitted') {
        alert('ì´ë¯¸ ì œì¶œëœ ë§í¬ì…ë‹ˆë‹¤.');
        submitBtn.disabled = true;
        submitBtn.textContent = 'ì œì¶œ ì™„ë£Œë¨';
      } else {
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'ì œì¶œí•˜ê¸°';
      }
    })
    .catch(error => {
      // CORS ë¬¸ì œ ë“±ìœ¼ë¡œ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆìœ¼ë‚˜, ë³´í†µ ë°ì´í„°ëŠ” ë“¤ì–´ê°‘ë‹ˆë‹¤.
      console.error('Error:', error);
      alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìœ¼ë‚˜, ë°ì´í„°ê°€ ì „ì†¡ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'ì œì¶œí•˜ê¸°';
    });
  }
</script>

</body>
</html>
